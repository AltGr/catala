\documentclass[12pt, french]{article}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{csquotes, textcomp}
\usepackage{fullpage}
\usepackage[french]{babel}
\usepackage[dvipsnames]{xcolor}
\usepackage[hidelinks]{hyperref}
\usepackage{fancyvrb}
\usepackage{tcolorbox}
\usepackage{amsmath, amssymb}

% \usepackage{draftwatermark}
% \SetWatermarkText{Brouillon}
% \SetWatermarkScale{1}
% \SetWatermarkColor[gray]{0.92}

\title{
  Proposition d'un langage de formalisation\\
  de textes législatifs :\\
  Questionnaire à l'intention de juristes
}
\author{
  Denis \bsc{Merigoux}\\Inria\and
  Liane \bsc{Huttner}\\Université Panthéon-Sorbonne\and
  Nicolas \bsc{Chataing}\\Inria -- École Normale Supérieure\and
}

\providecommand{\cm}[1]{\textit{\texttt{\textcolor{PineGreen}{#1}}}}
\newcommand{\kw}[1]{\textbf{\textcolor{OliveGreen}{#1}}}
\newcommand{\inlinekw}[1]{\kw{\texttt{#1}}}
\newenvironment{metadata}{
  \begin{tcolorbox}[colframe=OliveGreen, title=\textcolor{black}{\texttt{Métadonnées}}, before skip=1em, after skip=1em]
}{
\end{tcolorbox}
}


\begin{document}

\maketitle

\renewcommand{\contentsname}{Sommaire}
\tableofcontents

\section{Introduction}

\input{motivation.tex}

\section{Étude de cas : les allocations familiales}
Afin de mettre en pratique ces nouveaux concepts, nous vous proposons un exemple d'annotation d'un article de loi  définissant les allocations familiales par des morceaux de programmes écrits dans notre nouveau langage de programmation \emph{ad hoc}. Le guide de lecture ci-dessous contient normalement toutes les informations nécessaires à la compréhension des annotations informatiques.

\subsection{Guide de lecture}

\input{reading_guide}

\subsection{Exemple d'articles de loi annotés}

\begin{figure}[htpb]
\begin{metadata}
\begin{Verbatim}[commandchars=\\\{\}]
\kw{structure} Enfant :
  \kw{donnée} fin_obligation_scolaire \kw{contenu date}
  \kw{donnée} âge \kw{contenu entier}
  \kw{donnée} rémuneration \kw{contenu montant}

\kw{structure} Ménage :
  \kw{donnée} enfants \kw{collection contenu} Enfant
  \kw{donnée} enfant_plus_âgé \kw{contenu} Enfant \kw{optionnel}
  \kw{donnée} ressources \kw{contenu montant}

\kw{structure} L512_3 :
  \kw{donnée} âge_limite_alinéa_2 \kw{contenu entier}
  \kw{donnée} plafond_rémunération_alinéa_2 \kw{contenu montant}
  \kw{condition} droits_ouverts_prestations_familiales

\kw{structure} L521_1 :
  \kw{donnée} allocations_familiales \kw{contenu montant}
  \kw{condition} droits_ouverts_allocations_familiales
  \kw{donnée} allocation_forfaitaire \kw{contenu montant}
  \kw{condition} allocation_forfaitaire_versée
  \kw{donnée} nombre_minimum_enfants \kw{contenu montant}

\kw{structure} L521_3 :
  \kw{donnée} âge_limite_alinéa_1 \kw{contenu entier dépend de} Enfant
  \kw{donnée} minimum_alinéa_2 \kw{contenu montant}
  \kw{condition} droits_ouverts_majorations_allocations_familiales
  \kw{donnée} majorations_allocations_familiales \kw{contenu montant}

\kw{déclaration champ d'application} PrestationFamiliale :
  \kw{contexte} ménage \kw{structure} Ménage
  \kw{contexte} l512_3 \kw{structure} L512_3

\kw{déclaration champ d'application} AllocationsFamiliales :
  \kw{contexte} ménage \kw{structure} Ménage
  \kw{contexte} l521_1 \kw{structure} L521_1
  \kw{contexte} l521_3 \kw{structure} L521_3
\kw{inclus champ d'application} PrestationsFamiliales \kw{avec contexte}
  PrestationFamiliale.ménage = ménage
\end{Verbatim}
\end{metadata}
\caption{Métadonnées de l'ensemble du programme. Ce bloc est nécessaire à la complétude du programme informatique
mais est peu pertinent vis-à-vis de la correction par rapport à la loi; vous pouvez donc y prêter moins d'attention que les annotations.}
\end{figure}

\fvset{
  commandchars=\\\{\},
  numbers=left,
  framesep=3mm,
  frame=leftline,
  firstnumber=last,
  samepage=true,
  codes={\catcode`\$=3\catcode`\^=7}
}

\paragraph{Article L512-3} Sous réserve des règles particulières à chaque prestation, ouvre droit aux prestations familiales :

1°) tout enfant jusqu’à la fin de l’obligation scolaire ;
\begin{Verbatim}[firstnumber=1]
\kw{champ d’application} PrestationsFamiliales :
  \kw{règle sous condition}
    \kw{existe} enfant \kw{dans} ménage.enfants \kw{tel que}
      \kw{date_aujourd_hui} $\leqslant$ enfant.fin_obligation_scolaire
  \kw{conséquence} l512_3.droits_ouverts_prestations_familiales \kw{rempli}
\end{Verbatim}

2°) après la fin de l’obligation scolaire, et jusqu’à un âge limite, tout enfant dont la rémunération éventuelle n’excède pas un plafond

% ERROR here !
\begin{Verbatim}
\kw{champ d’application} PrestationsFamiliales :
  \kw{règle sous condition}
    \kw{existe} enfant \kw{dans} ménage.enfants \kw{tel que}
      date_aujourd_hui $\leqslant$ enfant.fin_obligation_scolaire \kw{et}
      enfant.rémunération $\leqslant$ l512_3.plafond_rémunération_alinéa_2 \kw{ou}
      enfant.âge $<$ l512_3.âge_limite_alinéa_2
  \kw{conséquence} l512_3.droits_ouverts_prestations_familiales \kw{rempli}
\end{Verbatim}

\paragraph{Article L521-1}

Les allocations familiales sont dues à partir du deuxième enfant à charge.

\begin{Verbatim}
\kw{champ d'application} AllocationsFamiliales :
  \kw{règle sous condition}
    \kw{nombre de} ménage.enfants $\geqslant$ 2
  \kw{conséquence} l521_1.droits_ouverts_allocations_familiales \kw{rempli}
\end{Verbatim}

Une allocation forfaitaire par enfant d'un montant fixé par décret est versée pendant un an à la personne ou au ménage qui assume la charge d'un nombre minimum d'enfants également fixé par décret lorsque l'un ou plusieurs des enfants qui ouvraient droit aux allocations familiales atteignent l'âge limite mentionné au 2° de l'article L. 512-3. Cette allocation est versée à la condition que le ou les enfants répondent aux conditions autres que celles de l'âge pour l'ouverture du droit aux allocations familiales.
\begin{Verbatim}
\kw{champ d'application} AllocationsFamiliales :
  \kw{assertion} l512_1.allocation_forfaitaire \kw{fixé par décret}
  \cm{# Pas marqué tel quel dans la loi mais important pour la cohérence}
  \kw{assertion}
    l521_1.allocation_forfaitaire_versée \kw{si et seulement si}
    l521_1.allocation_forfaitaire $>$ 0 €
  \kw{assertion} l512_1.nombre_minimum_enfants \kw{fixé par décret}
  \kw{règle sous condition}
    \kw{existe} enfant \kw{dans} ménage.enfants \kw{tel que}
    enfant.age $=$ l512_3.âge_limite_alinéa_2
    \cm{# et enfant répond aux autres conditions pour l'ouverture}
    \cm{# du droit aux allocations familiales (pas formalisé ici)}
  \kw{conséquence} l521_1.allocation_forfaitaire_versée \kw{rempli}
\end{Verbatim}

Le montant des allocations mentionnées aux deux premiers alinéas du présent article, ainsi que celui des majorations mentionnées à l'article L. 521-3 varient en fonction des ressources du ménage ou de la personne qui a la charge des enfants, selon un barème défini par décret.
\begin{Verbatim}
\kw{champ d'application} AllocationsFamiliales :
  \kw{assertion} l512_1.allocations_familiales \kw{fixé par décret}
  \kw{assertion} l512_1.allocations_familiales \kw{varie avec} ménage.ressources
  \kw{assertion} l521_3.majorations_allocations_familiales \kw{fixé par décret}
  \kw{assertion} l512_1.majorations_allocations_familiales \kw{varie avec}
     ménage.ressources
\end{Verbatim}

Le montant des allocations familiales varie en fonction du nombre d'enfants à charge.

\begin{Verbatim}
\kw{champ d'application} AllocationsFamiliales :
  \kw{assertion} l512_1.allocations_familiales \kw{varie avec}
     \kw{nombre de} ménage.enfants
\end{Verbatim}

Les niveaux des plafonds de ressources, qui varient en fonction du nombre d'enfants à charge, sont révisés conformément à l'évolution annuelle de l'indice des prix à la consommation, hors tabac.

\begin{Verbatim}
\cm{# Évolution pas formalisée ici}
\end{Verbatim}

Un complément dégressif est versé lorsque les ressources du bénéficiaire dépassent l'un des plafonds, dans la limite de montants définis par décret. Les modalités de calcul de ces montants et celles du complément dégressif sont définies par décret.

\begin{Verbatim}
\cm{# Plafonds et montants pas formalisés ici}
\end{Verbatim}

\paragraph{Article L521-3}

Chacun des enfants à charge, à l'exception du plus âgé, ouvre droit à partir d'un âge minimum à une majoration des allocations familiales.

\begin{Verbatim}
\kw{champ d'application} AllocationsFamiliales :
  \kw{règle sous condition}
    \kw{existe} enfant \kw{dans} ménage.enfants \kw{tel que}
      enfant $\neq$ ménage.enfant_plus_âgé \kw{et}
      enfant.âge $\geqslant$ (l521_3.âge_limite_alinéa_1 \kw{de} enfant)
  \kw{conséquence} l521_3.droits_ouverts_majorations_allocations_familiales \kw{rempli}
\end{Verbatim}


Toutefois, les personnes ayant un nombre déterminé d'enfants à charge bénéficient de ladite majoration pour chaque enfant à charge à partir de l'âge mentionné au premier alinéa.

\begin{Verbatim}
\kw{champ d'application} AllocationsFamiliales :
  \kw{règle sous condition}
    \kw{nombre de} ménage.enfants $\geqslant$ l512_3.minimum_alinéa_2 \kw{et}
    \kw{existe} enfant \kw{dans} ménage.enfants \kw{tel que}
      enfant.âge $\geqslant$ (l521_3.âge_limite_alinéa_1 \kw{de} enfant)
  \kw{conséquence} l521_3.droits_ouverts_majorations_allocations_familiales \kw{rempli}
\end{Verbatim}

\paragraph{Article R521-1}

L'âge mentionné au premier alinéa de l'article L. 521-3 à partir duquel les enfants ouvrent droit à la majoration des allocations familiales est fixé à 14 ans.
\begin{Verbatim}
\kw{champ d'application} AllocationsFamiliales :
  \kw{définition} l521_3.âge_limite_alinéa_1 \kw{de} enfant
    \kw{égal à} 14 an
\end{Verbatim}

Le nombre minimum d'enfants à charge, mentionné au deuxième alinéa de l'article L. 521-3 ouvrant droit à ladite majoration pour chaque enfant est fixé à trois.
\begin{Verbatim}
\kw{champ d'application} AllocationsFamiliales :
  \kw{définition} l521_3.minimum_alinéa_2
    \kw{égal à} 3
\end{Verbatim}


NOTA : Décret n° 2008-409 du 28 avril 2008 JORF du 29 avril 2008 art. 2 : Les modifications induites par le décret n° 2008-409 s'appliquent aux enfants dont le onzième anniversaire est postérieur au 30 avril 2008.

\begin{Verbatim}
\kw{champ d'application} AllocationsFamiliales :
  \kw{définition} l521_3.minimum_alinéa_2 \kw{de} enfant
    \kw{sous condition}
       \kw{non} (enfant.date_naissance + 11 an $>$ 30/04/2008)
    \cm{# Âge limite avant décret n\textsuperscript{o} 2008-409 du 28 avril 2008}
    \kw{conséquence} \kw{égal à} 16 an
\end{Verbatim}

\subsection{Questionnaire de satisfaction}

\input{questionnaire}


\end{document}
